<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>La carto des JO</title>
  <link href="./css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link rel="stylesheet" href="./css/leaflet.css" />
  <link rel="icon" type="image/x-icon" href="./favicon.ico">
  <style>
    #map {
      height: 700px;
    }
    .visavi .card{
        min-height: 1000px;
        margin: 20px 0;
    }
    abbr {
          text-decoration: underline dotted;
          cursor: help;
    }
    g {
	       opacity: 0.65;
    }
    .leaflet-tile-pane {
       filter: gray; /* IE6-9 */
       -webkit-filter: grayscale(1); /* Google Chrome, Safari 6+ & Opera 15+ */
       filter: grayscale(1); /* Microsoft Edge and Firefox 35+ */
       opacity: 0.5;
    }
    #map{
       background-color: white;
    }
    @keyframes blinker {
      50% { opacity: 0; }
    }
</style>
</head>
<body>
<nav class="navbar navbar-expand-md bg-dark border-bottom" data-bs-theme="dark">
  <div class="container">
      <div class="offcanvas-body text-white-50">
          <a href="https://technopolice.fr/" class="text-white-50">TECHNOPOLICE - Paris Banlieue</a> / <a class="text-white-50" href="https://cartodesjo.fr/">Carto des JO</a>
      </div>
    </div>
  </div>
</nav>

<main>
<div class="container">
<section class="py-2 text-center container">
  <div class="row py-lg-2">
    <div class="col-lg-6 col-md-8 mx-auto">
      <h1>Carto des JO</h1>
      <h2 class="fw-light">ce qui nous attend pour les JO</h1>
      <p class="lead text-body-secondary">Indiquer une adresse pour savoir à quoi vous préparer pour les JO :</p>
      <form id="addressForm">
        <input id="adresseInput" type="text" list="suggestionsList" placeholder="Votre adresse" class="form-control">
        <datalist id="suggestionsList"></datalist>
        <button type="submit" class="btn btn-primary my-2">Voir</button>
      </form>
    </div>
  </div>
</section>
<div class="row row-cols-1 row-cols-sm-1 row-cols-md-2 g-3 visavi">
  <div class="col">
    <div class="card shadow-sm">
        <div class="p-3">
            <div class="pb-4">
            <h2 class="text-center">Carte globale des «&nbsp;zones&nbsp;JO&nbsp;»</h2>
            <p class="text-center mx-1">Zones actives à un moment <span class="date_text">entre le 15 juillet et le 9 septembre 2024</span>
                <br/>
                (&nbsp;<a href="#" onclick="document.getElementById('changeDate').showModal();return false;">changer de période</a>
                | voir que <a href="#" onclick="selectToday();return false;">aujourd'hui</a>
                ou que <a href="#" onclick="selectTomorrow();return false;">demain</a>
                )</p>
            </div>
            <div id="map" class="pb-2 pt-2"></div>
            <p class="p-3 text-center m-3">Vue de l'ensemble des zones activées à un moment durant les jeux olympiques et paralympiques (<a href="#" onclick="document.getElementById('changeDate').showModal();return false;"><span class="date_text">entre le 15 juillet et le 9 septembre 2024</span></a>)</p>
        </div>
    </div>
  </div>

  <div class="col" id="explications">
    <div class="card shadow-sm">
        <div id="result" class="p-3">
                <h2 id="titre" class="pb-3">Vue globale</h2>
                <div id="zone_silt">
                <p><span style="background-color: black;  border: 2px solid black; opacity: 0.75;"> &nbsp; &nbsp; &nbsp; </span><span class="zone_silt"> &nbsp; <strong>Zone Anti-terroriste</strong> : Accès totalement interdit piétons comme véhicules. Pour les piétons non munis de billet, seules les personnes accréditées d'un QRCode (cf. zone rouge) pourront accéder à ces zones. Des « visites » administratives de tout lieu de la zone sont prévues par la loi SILT pour notamment saisir des données informatiques à des fins d'enquête administrative.</span></p>
                <p id="zone_silt_comment" class="zone_comment zone_silt">8,19 % de Paris est concerné par cette zone à un moment des Jeux olympiques et paralympiques.</p>
                </div>
                <div id="zone_rouge">
                <p><span style="background-color: red; border: 2px solid red; opacity: 0.75;"> &nbsp; &nbsp; &nbsp; </span><span class="zone_rouge"> &nbsp; <strong>Zone de circulation interdite</strong> : Accès interdit aux véhicules motorisés. Le site <a href="https://www.pass-jeux.gouv.fr/">Pass-Jeux</a> permet de déposer une demande de dérogation (et des pièces justificatives). Si la personne à l'origine de la demande n'est pas connue d'un des fichiers des services de renseignement et que le motif présenté et les pièces fournies sont jugées légitimes par la préfecture de police, un QRCode sera délivré. Il permettra l'entrée de la personne en véhicule motorisé dans la zone. Ce QRCode ne permettra pas aux véhicules de circuler pendant la durée des épreuves qui se dérouleront sur route. Les stationnements sur la voie publique seront peu ou pas possibles. La traversée de cette zone en vélo ou à pied sera autorisée.</span></p>
                <p id="zone_rouge_comment" class="zone_comment zone_rouge">63,80 % de Paris est concerné par cette zone à un moment des Jeux olympiques et paralympiques.</p>
                </div>
                <div id="zone_bleu">
                <p><span style="background-color: orange; border: 2px solid orange; opacity: 0.75;"> &nbsp; &nbsp; &nbsp; </span><span class="zone_bleu"> &nbsp; <strong>Zone de circulation réglementée</strong> : Le conducteur du véhicule doit être muni d'un QRCode d'accès à la zone rouge ou doit justifier auprès des forces de l'ordre en charge du barrage de son besoin d’accès à la zone (accès au domicile, travail, livraison, dépannage, déménagement, rendez-vous médical, ...). Traverser la zone ne sera pas possible.</span></p>
                <p id="zone_bleu_comment" class="zone_comment zone_bleu">66,27 % de Paris est concerné par cette zone à un moment des Jeux olympiques et paralympiques.</p>
                </div>
                <div id="zone_blanche">
                <p><span style="background-color: white; border: 2px solid gray;"> &nbsp; &nbsp; &nbsp; </span> &nbsp; <strong>Zone sans restriction préalable</strong> : La préfecture de police n'a pas annoncé de restriction sur cette zone mais elle peut prendre à tout moment un arrêté « ciblé » qui lui permet d'activer des restrictions mises oeuvres dans les autres zones.
                <br/>De plus, la loi JO a légalisé l'usage de la surveillance par intelligence artificielle (via caméras ou drones) qui pourra être activée sur l'ensemble des zones.
                </p>
                <p id="zone_blanche_comment" class="zone_comment">100 % de Paris est concerné par cette zone pendant les Jeux olympiques et paralympiques.</p>
                </div>
        </div>
    </div>
  </div>
</div>

<dialog id='changeDate'>
        <h3>Changer la période de la carte</h3>
        <div class="my-5 row">
            <div class="col-sm-1 mt-1">
                <label for="date_from" class="form-label">Du</label>
            </div>
            <div class="col-sm-5">
                <input type="date" class="form-control col-sm-4" id="date_from" value="2024-07-15" min="2024-07-01" max="2024-09-30"/>
            </div>
            <div class="col-sm-1 mt-1">
                <label for="date_to" class="form-label col-sm-1">au</label>
            </div>
            <div class="col-sm-5">
                <input type="date" class="form-control col-sm-4" id="date_to" value="2024-09-09"  min="2024-07-01" max="2024-09-30"/>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6"><input type=submit value="Annuler" class="btn btn-light" onclick="document.getElementById('changeDate').close();"/></div>
            <div class="col-sm-6 text-end"><input type=submit value="Changer" class="btn btn-primary" onclick="updateTooltipSelectLayersFromDateAndOrder();"/></div>
        </div>
</dialog>
<div class="row">
    <div class="col-sm-12">
      <div class="card shadow-sm p-3">
          <h2 class="pb-3">Sources</h2>
          <p>Voici les sources utilisées pour réaliser la cartographie et les informations publiées sur cette page :</p>
          <ul>
              <li><a href="https://www.prefecturedepolice.interieur.gouv.fr/mission/des-jeux-securises-pour-tous/les-perimetres-de-securite-autour-des-sites-olympiques-et-paralympiques">Les périmètres vus par la Préfecture de police</a></li>
              <li><a href="https://www.paris.fr/pages/perimetres-de-securite-et-circulation-pendant-les-jeux-comment-ca-marche-25203">Les périmètres par la Mairie de paris</a></li>
              <li><a href="https://www.prefecturedepolice.interieur.gouv.fr/sites/default/files/Documents/VD_%20Tableau%20d%C3%A9rogations%20acc%C3%A8s%20aux%20sites%20durant%20jop%20-%20hors%20CER.pdf">Tableau des dérogations (hors cérémonie et sa préparation) de la Préfecture de Police</a></li>
              <li><a href="https://www.prefecturedepolice.interieur.gouv.fr/sites/default/files/Documents/liste-personnesautorisees-ceremonie-ouverture-250424.pdf">Tableau des dérogations pour l'accès piétons et véhicules pour la cérémonie et sa préparation (Préfecture de Police)</a></li>
              <li><a href="https://www.paris.fr/pages/perimetres-de-securite-et-circulation-pendant-les-jeux-comment-ca-marche-25203#tableau-des-personnes-autorisees-a-acceder-aux-perimetres">Tableau des dérogations (hors cérémonie et prapartifs) de la Mairie de Paris</a></li>
              <li><a href="https://anticiperlesjeux.gouv.fr/je-minforme/carte-interactive-impacts-deplacements-ile-france">Carte du site anticiperlesjeux.gouv.fr</a></li>
              <li><a href="https://www.leparisien.fr/jo-paris-2024/ceremonie-douverture-des-jo-la-plate-forme-pour-entrer-dans-le-perimetre-de-securite-sera-en-ligne-le-10-mai-08-04-2024-7PHKYMLTURGMFNTZWXIKXACEUE.php">Prise de parole du ministre de l’Intérieur au Parisien</a></li>
              <li><a href="https://www.legifrance.gouv.fr/loda/id/JORFTEXT000044265118">Décret 2021-1397 sur les zone anti-terroristes comprenant notamment les lieux d'entrainements et les lieux non franciliens</a></li>
              <li><a href="https://www.vie-publique.fr/loi/287639-jo-2024-loi-du-19-mai-2023-jeux-olympiques-et-paralympiques">Loi Olympiques sur vie-publique.fr</a>
              <li><a href="https://www.vie-publique.fr/loi/20775-loi-securite-interieure-et-lutte-contre-le-terrorisme-loi-silt">Loi SILT sur vie-publique.fr</a>
          </ul>
          <h2 class="py-3">Approfondir</h2>
          <p>Voici quelques ressources pour approfondir les atteintes aux libertés individuelles lors des JO :</p>
          <ul>
              <li><a href="https://www.laquadrature.net/2023/01/18/non-a-la-videosurveillance-algorithmique-refusons-larticle-7-de-la-loi-olympique/">Analyse de la « Surveillance par intelligence Artificielle (VSA) » par La Quadrature du Net</a></li>
              <li><a href="https://www.ldh-france.org/wp-content/uploads/2017/10/avis-d%C3%A9taill%C3%A9-sur-le-projet-loi-s%C3%A9curit%C3%A9-int%C3%A9rieure-et-lutte-contre-terrorisme-juillet-2017-envoy%C3%A9-aux-d%C3%A9put%C3%A9s-et-s%C3%A9nateurs.pdf">Analyse de la loi SILT par la Ligue des droits de l'Homme</a></li>
          </ul>
          <h2 class="py-3">Crédits</h2>
          <p>Ce site est basé sur des données publiques issues de la <a href="https://www.prefecturedepolice.interieur.gouv.fr/">Préfecture de police de Paris</a> et d'<a href="https://www.openstreetmap.org/">Open Street Map</a>. Les GeoJSON conçus pour ce site sont librement réutilisables sous <a href="https://opendatacommons.org/licenses/odbl/">licence ODBL</a>. Ils sont téléchargeables <a href="./geojson/">ici</a>.</p>
          <p>Le code source de ce site un Logiciel Libre. Il est diffusé sous <a href="https://www.gnu.org/licenses/agpl-3.0.fr.html">licence AGPL</a>. Son code source est disponible <a href="https://github.com/teymour/cartodesjop/">ici</a>. Il se base sur les logiciels libres <a href="https://getbootstrap.com/">Bootstrap</a>, <a href="https://leafletjs.com/">Leaflet</a> et <a href="https://turfjs.org/">Turf.js</a>.</p>
          <p>La résolution d'adresse est possible grace au service public <a href="https://adresse.data.gouv.fr/">adresse.data.gouv.fr</a>, et le fond de carte <a href="https://www.openstreetmap.org/">OpenStreetMap</a>, grace à <a href="https://stadiamaps.com/">stadia maps</a> et <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a>.</p>
          <p>Ce projet a été initié par Tangui Morlier avec l'aide du groupe <a href="https://technopolice.fr/">Technopolice Paris Banlieue</a>.</p>
      </div>
  </div>
</div>

</div>
<div class="container">
</div>
</main>
<footer class="p-5">
    <p class="text-center text-muted">Fait en Open Data et Logiciel Libre par Tangui Morlier - <a href="https://www.gnu.org/licenses/agpl-3.0.fr.html">Affero GPL</a>/<a href="https://opendatacommons.org/licenses/odbl/">ODBL</a> - 2024</p>
</footer>
  <script src="./js/bootstrap.bundle.min.js"></script>
  <script src="./js/leaflet.js"></script>
  <script src="./js/turf.min.js"></script>
  <script>
    var map = L.map('map').setView([48.8695866, 2.3541869], 12);

    L.tileLayer('https://a.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, <a href="https://www.prefecturedepolice.interieur.gouv.fr/">PPP</a> & T. Morlier'
    }).addTo(map);

    var geojsonLayers = {};
    var geojsonPaths = {
        "rouge": {
            "geojson/20240715-20240910_perimetre_CIRCULATION-DISPOSITIF-VILLAGE-OLYMPIQUE-SP_rouge.geojson": "VILLAGE OLYMPIQUE",
            "geojson/20240718-20240725_pdf_cer1-j8j1-4ep-LOYL_rouge.geojson": "Préparation de la cérémonie d'ouverture",
            "geojson/20240718-20240725_perimetre_CER1-JoursAvants_rouge.geojson": "Préparation de la cérémonie d'ouverture",
            "geojson/20240724-20240727_perimetre_cyclisme-clm-fam_rouge.geojson": "Cyclisme (course et familiarisation)",
            "geojson/20240724-20240727_perimetre_cyclisme-clm_rouge.geojson": "Cyclisme (course et familiarisation)",
            "geojson/20240724-20240810_perimetre_CIRCULATION-DISPOSITIF-PARC-DES-PRINCES-SP_rouge.geojson": "PARC DES PRINCES",
            "geojson/20240724-20240909_perimetre_CIRCULATION-DISPOSITIF-STADE-DE-FRANCE-SP_rouge.geojson": "STADE DE FRANCE",
            "geojson/20240725-20240905_perimetre_CIRCULATION-DISPOSITIF-INVALIDES-SP_rouge.geojson": "INVALIDES",
            "geojson/20240725-20240907_perimetre_CIRCULATION-DISPOSITIF-ARENA-PARIS-SUD-SP_rouge.geojson": "ARENA PARIS SUD",
            "geojson/20240726-20240726_pdf_cer1-jj-4ep-Wye8_rouge.geojson": "Cérémonie d'ouverture",
            "geojson/20240726-20240726_perimetre_CER1-JourJ_rouge.geojson": "Cérémonie d'ouverture",
            "geojson/20240726-20240811_perimetre_CIRCULATION-DISPOSITIF-TROCADERO-SP_rouge.geojson": "TROCADERO",
            "geojson/20240727-20240809_perimetre_CIRCULATION-DISPOSITIF-STADE-YVES-DU-MANOIR-SP_rouge.geojson": "STADE YVES DU MANOIR",
            "geojson/20240727-20240810_perimetre_CIRCULATION-DISPOSITIF-CENTRE-AQUATIQUE-SP_rouge.geojson": "CENTRE AQUATIQUE",
            "geojson/20240727-20240905_perimetre_CIRCULATION-DISPOSITIF-ARENA-PORTE-DE-LA-CHAPELLE-SP_rouge.geojson": "ARENA PORTE DE LA CHAPELLE",
            "geojson/20240727-20240907_perimetre_CIRCULATION-DISPOSITIF-ARENA-PARIS-NORD-SP_rouge.geojson": "ARENA PARIS NORD",
            "geojson/20240727-20240907_perimetre_CIRCULATION-DISPOSITIF-CHATEAU-DE-VERSAILLES-SP_rouge.geojson": "CHATEAU DE VERSAILLES",
            "geojson/20240727-20240907_perimetre_CIRCULATION-DISPOSITIF-EIFFEL-CHAMP-DE-MARS-SP_rouge.geojson": "EIFFEL CHAMP DE MARS",
            "geojson/20240727-20240907_perimetre_CIRCULATION-DISPOSITIF-PARIS-LA-DEFENSE-ARENA-SP_rouge.geojson": "PARIS LA DEFENSE ARENA",
            "geojson/20240727-20240907_perimetre_CIRCULATION-DISPOSITIF-STADE-ROLAND-GARROS-SP_rouge.geojson": "STADE ROLAND GARROS",
            "geojson/20240727-20240908_perimetre_CIRCULATION-DISPOSITIF-ARENA-BERCY-SP_rouge.geojson": "ARENA BERCY",
            "geojson/20240727-20240908_perimetre_CIRCULATION-DISPOSITIF-GRAND-PALAIS-SP_rouge.geojson": "GRAND PALAIS",
            "geojson/20240727-20240908_perimetre_CIRCULATION-DISPOSITIF-LA-CONCORDE-SP_rouge.geojson": "LA CONCORDE",
            "geojson/20240727-20240908_perimetre_CIRCULATION-DISPOSITIF-LCO-GRX-SP_rouge.geojson": "LCO GRX",
            "geojson/20240727-20240908_perimetre_CIRCULATION-DISPOSITIF-STADE-NAUTIQUE-DE-VAIRES-SUR-MARNE-SP_rouge.geojson": "STADE NAUTIQUE DE VAIRES SUR MARNE",
            "geojson/20240728-20240729_perimetre_CIRCULATION-DISPOSITIF-COLLINE-D-ELANCOURT-SP_rouge.geojson": "COLLINE D ELANCOURT",
            "geojson/20240728-20240805_perimetre_triathlon-fam-Cyc-Nat_rouge.geojson": "triathlon",
            "geojson/20240728-20240805_perimetre_triathlon-indiv-femme_rouge.geojson": "triathlon",
            "geojson/20240728-20240805_perimetre_triathlon-indiv-homme_rouge.geojson": "triathlon",
            "geojson/20240728-20240805_perimetre_triathlon-relaix-mixte_rouge.geojson": "triathlon",
            "geojson/20240801-20240810_perimetre_CIRCULATION-DISPOSITIF-LE-GOLF-NATIONAL-SP_rouge.geojson": "LE GOLF NATIONAL",
            "geojson/20240801-20240901_perimetre_CIRCULATION-DISPOSITIF-VELODROME-NATIONAL-DE-SAINT-QUENTIN-EN-YVELINES-SP_rouge.geojson": "VELODROME NATIONAL DE SAINT QUENTIN EN YVELINES",
            "geojson/20240801-20240801_perimetre_course-en-ligne_rouge.geojson": "Familiarisation Course en ligne ",
            "geojson/20240803-20240804_perimetre_course-en-ligne-homme_rouge.geojson": "Course en ligne",
            "geojson/20240803-20240804_perimetre_cyclisme-courseenligne-femme_rouge.geojson": "Course en ligne",
            "geojson/20240805-20240810_perimetre_CIRCULATION-DISPOSITIF-SITE-D-ESCALADE-DU-BOURGET-SP_rouge.geojson": "SITE D ESCALADE DU BOURGET",
            "geojson/20240810-20240811_perimetre_marathon-femme_rouge.geojson": "Marathon",
            "geojson/20240810-20240811_perimetre_marathon-homme_rouge.geojson": "Marathon",
            "geojson/20240810-20240811_perimetre_marathon-pour-tous_rouge.geojson": "Marathon",
            "geojson/20240828-20240828_perimetre_CER3-Ceremonie-d-ouverture-Jeux-Paralympiques_rouge.geojson": "Cérémonie d'ouverture paralympique",
            "geojson/20240903-20240908_perimetre_PARA-Cyclisme-fam_rouge.geojson": "Cyclisme",
            "geojson/20240903-20240908_perimetre_PARA-MassEvent_rouge.geojson": "MassEvent",
            "geojson/20240904-20240907_perimetre_PARA-Cyclisme-Contre-la-Montre_rouge.geojson": "Cyclisme",
            "geojson/20240904-20240907_perimetre_PARA-Cyclisme-Course-sur-route-J1_rouge.geojson": "Cyclisme",
            "geojson/20240904-20240907_perimetre_PARA-Cyclisme-Course-sur-route-J2_rouge.geojson": "Cyclisme",
            "geojson/20240904-20240907_perimetre_PARA-Cyclisme-Course-sur-route-J3_rouge.geojson": "Cyclisme",
            "geojson/20240908-20240908_perimetre_PARA-Marathon_rouge.geojson": "Marathon",
            "geojson/20240908-20240909_perimetre_CER4-Ceremonie-de-cloture-des-jeux-paralympiques_rouge.geojson": "Ceremonie de cloture des jeux paralympiques"
        },
        "bleu": {
            "geojson/20240715-20240910_perimetre_CIRCULATION-DISPOSITIF-CENTRE-AQUATIQUE-SP_bleu.geojson": "CENTRE AQUATIQUE",
            "geojson/20240715-20240910_perimetre_CIRCULATION-DISPOSITIF-VILLAGE-OLYMPIQUE-SP_bleu.geojson": "VILLAGE OLYMPIQUE",
            "geojson/20240718-20240725_pdf_cer1-j8j1-4ep-LOYL_bleu.geojson": "Préparation de la cérémonie d'ouverture",
            "geojson/20240718-20240725_perimetre_CER1-JoursAvants_bleu.geojson": "Préparation de la cérémonie d'ouverture",
            "geojson/20240724-20240727_perimetre_cyclisme-clm_bleu.geojson": "Cyclisme",
            "geojson/20240724-20240727_perimetre_cyclisme-clm-fam_bleu.geojson": "Cyclisme",
            "geojson/20240724-20240810_perimetre_CIRCULATION-DISPOSITIF-PARC-DES-PRINCES-SP_bleu.geojson": "PARC DES PRINCES",
            "geojson/20240724-20240909_perimetre_CIRCULATION-DISPOSITIF-STADE-DE-FRANCE-SP_bleu.geojson": "STADE DE FRANCE",
            "geojson/20240725-20240905_perimetre_CIRCULATION-DISPOSITIF-INVALIDES-SP_bleu.geojson": "INVALIDES",
            "geojson/20240725-20240907_perimetre_CIRCULATION-DISPOSITIF-ARENA-PARIS-SUD-SP_bleu.geojson": "ARENA PARIS SUD",
            "geojson/20240726-20240811_perimetre_CIRCULATION-DISPOSITIF-TROCADERO-SP_bleu.geojson": "TROCADERO",
            "geojson/20240727-20240809_perimetre_CIRCULATION-DISPOSITIF-STADE-YVES-DU-MANOIR-SP_bleu.geojson": "STADE YVES DU MANOIR",
            "geojson/20240727-20240810_perimetre_CIRCULATION-DISPOSITIF-CENTRE-AQUATIQUE-SP_bleu.geojson": "CENTRE AQUATIQUE",
            "geojson/20240727-20240905_perimetre_CIRCULATION-DISPOSITIF-ARENA-PORTE-DE-LA-CHAPELLE-SP_bleu.geojson": "ARENA PORTE DE LA CHAPELLE",
            "geojson/20240727-20240907_perimetre_CIRCULATION-DISPOSITIF-ARENA-PARIS-NORD-SP_bleu.geojson": "ARENA PARIS NORD",
            "geojson/20240727-20240907_perimetre_CIRCULATION-DISPOSITIF-CHATEAU-DE-VERSAILLES-SP_bleu.geojson": "CHATEAU DE VERSAILLES",
            "geojson/20240727-20240907_perimetre_CIRCULATION-DISPOSITIF-EIFFEL-CHAMP-DE-MARS-SP_bleu.geojson": "EIFFEL CHAMP DE MARS",
            "geojson/20240727-20240907_perimetre_CIRCULATION-DISPOSITIF-PARIS-LA-DEFENSE-ARENA-SP_bleu.geojson": "PARIS LA DEFENSE ARENA",
            "geojson/20240727-20240907_perimetre_CIRCULATION-DISPOSITIF-STADE-ROLAND-GARROS-SP_bleu.geojson": "STADE ROLAND GARROS",
            "geojson/20240727-20240908_perimetre_CIRCULATION-DISPOSITIF-ARENA-BERCY-SP_bleu.geojson": "ARENA BERCY",
            "geojson/20240727-20240908_perimetre_CIRCULATION-DISPOSITIF-GRAND-PALAIS-SP_bleu.geojson": "GRAND PALAIS",
            "geojson/20240727-20240908_perimetre_CIRCULATION-DISPOSITIF-LA-CONCORDE-SP_bleu.geojson": "LA CONCORDE",
            "geojson/20240727-20240908_perimetre_CIRCULATION-DISPOSITIF-LCO-GRX-SP_bleu.geojson": "LCO GRX",
            "geojson/20240728-20240729_perimetre_CIRCULATION-DISPOSITIF-COLLINE-D-ELANCOURT-SP_bleu.geojson": "COLLINE D ELANCOURT",
            "geojson/20240728-20240805_perimetre_triathlon-fam-Cyc-Nat_bleu.geojson": "triathlon",
            "geojson/20240728-20240805_perimetre_triathlon-indiv-femme_bleu.geojson": "triathlon",
            "geojson/20240728-20240805_perimetre_triathlon-indiv-homme_bleu.geojson": "triathlon",
            "geojson/20240728-20240805_perimetre_triathlon-relaix-mixte_bleu.geojson": "triathlon",
            "geojson/20240801-20240810_perimetre_CIRCULATION-DISPOSITIF-LE-GOLF-NATIONAL-SP_bleu.geojson": "LE GOLF NATIONAL",
            "geojson/20240801-20240901_perimetre_CIRCULATION-DISPOSITIF-VELODROME-NATIONAL-DE-SAINT-QUENTIN-EN-YVELINES-SP_bleu.geojson": "VELODROME NATIONAL DE SAINT QUENTIN EN YVELINES",
            "geojson/20240803-20240804_perimetre_course-en-ligne-homme_bleu.geojson": "Course en ligne",
            "geojson/20240803-20240804_perimetre_cyclisme-courseenligne-femme_bleu.geojson": "Course en ligne",
            "geojson/20240810-20240811_perimetre_marathon-femme_bleu.geojson": "Marathon",
            "geojson/20240810-20240811_perimetre_marathon-homme_bleu.geojson": "Marathon",
            "geojson/20240810-20240811_perimetre_marathon-pour-tous_bleu.geojson": "Marathon"
    },
    "silt": {
        "geojson/20240718-20240725_perimetre_CER1-JoursAvants_silt.geojson": "Préparation de la cérémonie d'ouverture",
        "geojson/20240726-20240726_parisien_cer-jj_silt.geojson": "Cérémonie d'ouverture",
        "geojson/20240726-20240726_pdf_cer1-jj-4ep-Wye8_silt.geojson": "Cérémonie d'ouverture",
        "geojson/20240724-20240811_presentation_sites-olympiques-vue-92-4ep-ejtY-colombes_silt.geojson": "Site olympique",
        "geojson/20240724-20240811_presentation_sites-olympiques-vue-92-4ep-ejtY-defense_silt.geojson": "Site olympique",
        "geojson/20240724-20240811_presentation_sites-olympiques-vue-93-4ep-am7z-circuit_silt.geojson": "Site olympique",
        "geojson/20240724-20240811_presentation_sites-olympiques-vue-93-4ep-am7z-saintdenis-1_silt.geojson": "Site olympique",
        "geojson/20240724-20240811_presentation_sites-olympiques-vue-93-4ep-am7z-saintdenis-2_silt.geojson": "Site olympique",
        "geojson/20240727-20240811_perimettre_3-Sites-Olympique-Saint-Quentin-en-Yvelines-Yvelines-78_silt.geojson": "Site olympique",
        "geojson/20240727-20240811_perimettre_5-Sites-Olympiques-Elancourt-Yvelines-78_silt.geojson": "Site olympique",
        "geojson/20240727-20240811_perimettre_6-Sites-Olympiques-Golf-National-Yvelines-78_silt.geojson": "Site olympique",
        "geojson/20240727-20240811_perimettre_Presentation-Sites-olympiques-Vue77-2EP_silt.geojson": "Site olympique",
        "geojson/20240727-20240811_perimettre_Sites-Olympiques-Chateau-de-Versailles-Yvelines-78_silt.geojson": "Site olympique",
        "geojson/20240724-20240811_presentation_sites-olympiques-vues-paris-4ep-01-QT2t_silt.geojson": "Site olympique",
        "geojson/20240724-20240811_presentation_sites-olympiques-vues-paris-4ep-02-0l7u_silt.geojson": "Site olympique",
        "geojson/20240724-20240811_presentation_sites-olympiques-vues-paris-4ep-03-gfyW_silt.geojson": "Site olympique",
        "geojson/20240724-20240811_presentation_sites-olympiques-vues-paris-4ep-04-jYaC_silt.geojson": "Site olympique",
        "geojson/20240724-20240811_presentation_sites-olympiques-vues-paris-4ep-05-royF_silt.geojson": "Site olympique",
        "geojson/20240828-20240908_presentation_sites-olympiques-vue-93-4ep-am7z-circuit_silt.geojson": "Site olympique",
        "geojson/20240828-20240908_presentation_sites-olympiques-vues-paris-4ep-01-QT2t_silt.geojson": "Site olympique",
        "geojson/20240828-20240908_presentation_sites-olympiques-vues-paris-4ep-02-0l7u_silt.geojson": "Site olympique",
        "geojson/20240828-20240908_presentation_sites-olympiques-vues-paris-4ep-03-gfyW_silt.geojson": "Site olympique",
        "geojson/20240828-20240908_presentation_sites-olympiques-vues-paris-4ep-04-jYaC_silt.geojson": "Site olympique",
        "geojson/20240828-20240908_presentation_sites-olympiques-vues-paris-4ep-05-royF_silt.geojson": "Site olympique",
        "geojson/20240829-20240907_perimettre_3-Sites-Olympique-Saint-Quentin-en-Yvelines-Yvelines-78_silt.geojson": "Site olympique",
        "geojson/20240829-20240907_perimettre_Sites-Olympiques-Chateau-de-Versailles-Yvelines-78_silt.geojson": "Site olympique",
        "geojson/20240830-20240901_perimettre_Presentation-Sites-olympiques-Vue77-2EP_silt.geojson": "Site olympique",
        "geojson/20240906-20240908_perimettre_Presentation-Sites-olympiques-Vue77-2EP_silt.geojson": "Site olympique",
        "geojson/20240423-20240908_perimetre_decret-2021-1397_silt.geojson": "Décret n°2021-1397",
        "geojson/20240603-20240908_perimetre_decret-2021-1397_silt.geojson": "Décret n°2021-1397",
        "geojson/20240708-20240904_perimetre_decret-2021-1397_silt.geojson": "Décret n°2021-1397",
        "geojson/20240710-20240805_perimetre_decret-2021-1397_silt.geojson": "Décret n°2021-1397",
        "geojson/20240710-20240811_perimetre_decret-2021-1397-RMSS_silt.geojson": "Décret n°2021-1397",
        "geojson/20240710-20240811_perimetre_decret-2021-1397_silt.geojson": "Décret n°2021-1397",
        "geojson/20240710-20240908_perimetre_decret-2021-1397_silt.geojson": "Décret n°2021-1397",
        "geojson/20240711-20240908_perimetre_decret-2021-1397_silt.geojson": "Décret n°2021-1397",
        "geojson/20240712-20240811_perimetre_decret-2021-1397_silt.geojson": "Décret n°2021-1397",
        "geojson/20240714-20240804_perimetre_decret-2021-1397_silt.geojson": "Décret n°2021-1397",
        "geojson/20240714-20240810_perimetre_decret-2021-1397_silt.geojson": "Décret n°2021-1397",
        "geojson/20240714-20240811_perimetre_decret-2021-1397-montreuil_silt.geojson": "Décret n°2021-1397",
        "geojson/20240714-20240811_perimetre_decret-2021-1397-paris_silt.geojson": "Décret n°2021-1397",
        "geojson/20240714-20240811_perimetre_decret-2021-1397_silt.geojson": "Décret n°2021-1397",
        "geojson/20240715-20240811_perimetre_decret-2021-1397_silt.geojson": "Décret n°2021-1397",
        "geojson/20240716-20240811_perimetre_decret-2021-1397_silt.geojson": "Décret n°2021-1397",
        "geojson/20240717-20240908_perimetre_decret-2021-1397_silt.geojson": "Décret n°2021-1397",
        "geojson/20240717-20240809_perimetre_decret-2021-1397_silt.geojson": "Décret n°2021-1397",
        "geojson/20240718-20240811_perimetre_decret-2021-1397-nord_silt.geojson": "Décret n°2021-1397",
        "geojson/20240718-20240811_perimetre_decret-2021-1397_silt.geojson": "Décret n°2021-1397",
        "geojson/20240719-20240811_perimetre_decret-2021-1397_silt.geojson": "Décret n°2021-1397",
        "geojson/20240720-20240810_perimetre_decret-2021-1397_silt.geojson": "Décret n°2021-1397",
        "geojson/20240722-20240811_perimetre_decret-2021-1397_silt.geojson": "Décret n°2021-1397",
        "geojson/20240723-20240811_perimetre_decret-2021-1397_silt.geojson": "Décret n°2021-1397",
        "geojson/20240726-20240908_perimetre_decret-2021-1397_silt.geojson": "Décret n°2021-1397",
        "geojson/20240727-20240811_perimetre_decret-2021-1397_silt.geojson": "Décret n°2021-1397",
        "geojson/20240810-20240811_perimetre_decret-2021-1397_silt.geojson": "Décret n°2021-1397",
        "geojson/20240816-20240908_perimetre_decret-2021-1397_silt.geojson": "Décret n°2021-1397"
    }};

geojsonPaths_arrondissements = [
    "geojson/arrondissements.geojson",
]

    function addGeoJSONToMap(geojson, layerName, color, opacity) {
      var layer = L.geoJSON(geojson, {
        style: function (feature) {
          return {
              'color': color,
              'opacity': 1,
              'fillOpacity': opacity
          };
        }
      }).addTo(map);
      geojsonLayers[layerName] = layer;
    }

    function loadGeoJSONFiles(geojsons, color, opacity) {
      geojsons.forEach(function (path) {
        fetch(path)
          .then(response => response.json())
          .then(data => {
            addGeoJSONToMap(data, path, color, opacity);
          });
      });
    }

    loadGeoJSONFiles(Object.keys(geojsonPaths['bleu']), 'orange', 1);
    loadGeoJSONFiles(Object.keys(geojsonPaths['rouge']), 'red', 1);
    loadGeoJSONFiles(Object.keys(geojsonPaths['silt']), 'black', 1);
    loadGeoJSONFiles(geojsonPaths_arrondissements, 'gray', 0);

    function searchAddresses() {
        const query = input.value;
        if (query.length < 5) {
            return;
        }
        fetch(`https://api-adresse.data.gouv.fr/search/?lat=48.8566&lon=2.3522&q=${encodeURIComponent(query)}`)
            .then(response => response.json())
            .then(data => {
                const addresses = data.features.map(feature => feature);
                displayAddressesSuggestions(addresses);
            })
            .catch(error => {
                console.error('Erreur lors de la recherche d\'adresses :', error);
            });
    }

    function displayAddressesSuggestions(addresses) {
        const suggestionsList = document.getElementById('suggestionsList');
        suggestionsList.innerHTML = '';
        addresses.forEach(feature => {
            const listItem = document.createElement('option');
            listItem.value = feature.properties.label;
            listItem.textContent = feature.properties.label;
            listItem.setAttribute('data-lng', feature.geometry.coordinates[0]);
            listItem.setAttribute('data-lat', feature.geometry.coordinates[1]);
            suggestionsList.appendChild(listItem);
        });
    }

    const input = document.getElementById('adresseInput');
    input.addEventListener('input', function(event) {
        searchAddresses();
    });


    function findLayersContainingPoint(point, pseudo_rayon = 1, exclude = []) {
      var layersContainingPoint = [];
      for (var layerName in geojsonLayers) {
        if (geojsonLayers.hasOwnProperty(layerName)) {
          var layer = geojsonLayers[layerName];
          layer.eachLayer(function (feature) {
            const carre = turf.polygon([[
                                    [point.lng - pseudo_rayon / 222000, point.lat - pseudo_rayon / 222000],
                                    [point.lng + pseudo_rayon / 222000, point.lat - pseudo_rayon / 222000],
                                    [point.lng + pseudo_rayon / 222000, point.lat + pseudo_rayon / 222000],
                                    [point.lng - pseudo_rayon / 222000, point.lat + pseudo_rayon / 222000],
                                    [point.lng - pseudo_rayon / 222000, point.lat - pseudo_rayon / 222000]
                                ]]);
            const inters = turf.intersect(feature.toGeoJSON().geometry, carre);
            if (inters && layersContainingPoint.indexOf(layerName) == -1 && exclude.indexOf(layerName) == -1) {
              layersContainingPoint.push(layerName);
            }
          });
        }
      }
      return layersContainingPoint;
    }
    document.getElementById('addressForm').addEventListener('submit', function (event) {
        event.preventDefault();
        searchAddresses();
        setTimeout(addressSubmit, 100);
    });
    function addressSubmit() {
        if (!document.getElementById('suggestionsList').children.length) {
            setTimeout(addressSubmit, 100);
            return;
        }
        var address = document.getElementById('suggestionsList').children[0];
        var point = L.latLng( address.dataset.lat, address.dataset.lng);
        var layersContainingPoint = { "inside": [], "near": []}
        layersContainingPoint["inside"] = findLayersContainingPoint(point);
        layersContainingPoint["near"] = findLayersContainingPoint(point, 100, layersContainingPoint['inside']);

        var actifs = {
            "rouge": {'inside': {}, 'near': {}},
            "silt": {'inside': {}, 'near': {}},
            "bleu": {'inside': {}, 'near': {}}
        };

        ['inside', 'near'].forEach(function(proximity) {
            layersContainingPoint[proximity].forEach(function (layer){
                infos = layer.split('_');
                if (!infos[1]) {
                    return;
                }
                zone = infos[3].replace('.geojson', '');
                dates = infos[0].replace('geojson/', '');
                if (!actifs[zone][proximity][dates]) {
                    actifs[zone][proximity][dates] = [];
                }
                actifs[zone][proximity][dates].push(layer);
            });
        });

        var titreDiv = document.getElementById('titre');
        titreDiv.innerHTML = '<center>Dates des zones concernées pour "' + address.innerHTML+'"</center>';
        var prev = false;
        ['silt', 'rouge', 'bleu'].forEach(function(zone) {
            comment = {"inside": "", "near": ""};
            ['inside', 'near'].forEach(function(proximity) {
                if (Object.keys(actifs[zone][proximity]).length) {
                    nb = 0;
                    Object.keys(actifs[zone][proximity]).forEach((item) => {
                        sources = [];
                        actifs[zone][proximity][item].forEach((item) => {
                            s = geojsonPaths[zone][item];
                            if (sources.indexOf(s) === -1) {
                                sources.push(s)
                            }
                        });

                        if (nb) {
                            comment[proximity] += " et";
                        }
                        dates = item.split('-');
                        tooltype = 'data-bs-toggle="tooltip" title="'+sources.join(', ')+'"';
                        if (dates[0] == dates[1]) {
                            comment[proximity] += " le <abbr "+tooltype+">"+dates[0].replace(/(....)(..)(..)/, '$3/$2/$1')+"</abbr>";
                        }else{
                            comment[proximity] += " du <abbr "+tooltype+">"+dates[0].replace(/(....)(..)(..)/, '$3/$2/$1')+" au "+dates[1].replace(/(....)(..)(..)/, '$3/$2/$1')+"</abbr>";
                        }
                        nb++;
                    });
                }
            })
            opacity = "0.5";
            html_comment = "<strong>";
            if(comment['inside'] || comment['near']) {
                prev = true;
                if(comment['inside']) {
                    html_comment += "<span style='color:red'>Vous êtes concerné⋅e par cette zone "+comment['inside']+".</span> ";
                }
                if(comment['near']) {
                    html_comment += comment["near"].charAt(1).toUpperCase() + comment["near"].slice(2);
                    html_comment += ", l'adresse indiquée ce situant à moins de 100 mètres d'une de ces zones, il est possible que vous soyez";
                    if(comment['inside']) {
                        html_comment += " également";
                    }
                    html_comment += " concerné⋅e.";
                }
                opacity = '1';
            }else{
                if (prev) {
                    html_comment += "Ayant une autre zone active, vous êtes également concerné⋅e par les règles de cette zone pour les même dates.";
                    opacity = '1';
                }else{
                    html_comment += "Vous n'êtes pas concerné⋅e par cette zone.";
                }
            }
            html_comment += "</strong>";
            document.getElementById('zone_'+zone+'_comment').innerHTML = html_comment;
            classes = document.getElementsByClassName('zone_'+zone);
            for (let i = 0; i < classes.length; i++) {
                classes[i].style = "opacity:"+opacity+";";
            }
        });
        document.getElementById('zone_blanche_comment').innerHTML = "<strong>Comme tous les habitants d'un département accueillant les jeux, vous êtes concerné par cette zone.</strong>";

        updateTooltipSelectLayersFromDateAndOrder();
        if (marker) {
            map.removeLayer(marker)
        }
        marker = L.marker(point)
        map.addLayer(marker);
        map.setView(point, 13);
        document.getElementById('adresseInput').blur();
        window.setTimeout(function(){
            document.getElementById("explications").scrollIntoView();
            classes = document.getElementsByClassName('zone_comment');
            for (let i = 0; i < classes.length; i++) {
                console.log(['blink', classes]);
                classes[i].style = "animation: blinker 1s linear 2;";
            }
        }, 500);
    }
    var marker;

    var removed = [];
    const months = { "07":"juillet", "08":"août", "09":"septembre" };
    function selectToday() {
      const today = new Date();
      selectDay(today);
    }
    function selectTomorrow() {
      const tomorrow = new Date();
      tomorrow.setDate(tomorrow.getDate() + 1);
      selectDay(tomorrow);
    }

    function selectDay(selectedDate) {
      document.getElementById('date_from').value = selectedDate.toISOString().split('T')[0];
      document.getElementById('date_to').value = selectedDate.toISOString().split('T')[0];

      updateTooltipSelectLayersFromDateAndOrder();
    }
    function updateTooltipSelectLayersFromDateAndOrder() {

        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
          return new bootstrap.Tooltip(tooltipTriggerEl)
        });

        document.getElementById('changeDate').close();
        const from_date = document.getElementById('date_from').value.replaceAll('-', '');
        const to_date = document.getElementById('date_to').value.replaceAll('-', '');

        let date_text = "à un moment entre le " + from_date.substring(6, 8) * 1 + " " + months[from_date.substring(4, 6)] + " et le " + to_date.substring(6, 8) * 1 + " " + months[to_date.substring(4, 6)] +" 2024";

        if (from_date == to_date) {
          date_text = "le " + from_date.substring(6, 8) * 1 + " " + months[from_date.substring(4, 6)] +" 2024";
        }

        date_span = document.getElementsByClassName('date_text');
        for(i in date_span) {
            date_span[i].innerHTML = date_text
        }
        Object.keys(geojsonLayers).forEach(function (layerid) {
            if (layerid == 'geojson/arrondissements.geojson') {
                return;
            }
            range = layerid.substring(8,25).split('-');
            if (from_date > range[1] || range[0] > to_date) {
                console.log(['layerid disabled', layerid, range]);
                map.removeLayer(geojsonLayers[layerid]);
                removed.push(layerid);
            }else{
                console.log(['layerid enabled', layerid, range]);
                const index = removed.indexOf(layerid);
                if (index > -1) {
                    geojsonLayers[layerid].addTo(map);
                    removed.splice(index, 1);
                }
            }
        });

        orderLayers();
    }
    function orderLayers() {
        for(var layerName in geojsonPaths['rouge']) {
            geojsonLayers[layerName].bringToBack();
        }
        for(var layerName in geojsonPaths['bleu']) {
            geojsonLayers[layerName].bringToBack();
        }
        for(var layerName in geojsonPaths['silt']) {
            geojsonLayers[layerName].bringToFront();
        }
        geojsonLayers['geojson/arrondissements.geojson'].bringToFront();
    }
    function loaded() {
        if (Object.keys(geojsonLayers).length != Object.keys(geojsonPaths['rouge']).length + Object.keys(geojsonPaths['bleu']).length +Object.keys(geojsonPaths['silt']).length + 1) {
            console.log(['wrong nb layers']);
            window.setTimeout(loaded, 250);
            return;
        }
        //On s'assure que tous les layers sont bien chargés
        var layerName;
        try {
            ['silt', 'rouge', 'bleu'].forEach(function(zone) {
                for(layerName in Object.keys(geojsonPaths[zone])) {
                    geojsonLayers[layerName];
                }
            })
        }catch (e) {
            console.log(['layer not loaded yet', layerName, e]);
            window.setTimeout(loaded, 250);
            return;
        }
        updateTooltipSelectLayersFromDateAndOrder();
    }
    loaded();
  </script>
</body>
</html>
